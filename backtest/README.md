# å¢å¼ºç‰ˆå›æµ‹ç³»ç»Ÿ

## æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªé›†æˆäº†RuleGoå†³ç­–å¼•æ“å’ŒFeastç‰¹å¾å­˜å‚¨çš„å¢å¼ºç‰ˆå›æµ‹ç³»ç»Ÿï¼Œæ”¯æŒç¦»çº¿å†å²æ•°æ®å›æµ‹ã€‚

## ä¸»è¦ç‰¹æ€§

### ğŸš€ æ ¸å¿ƒåŠŸèƒ½
- **RuleGoé›†æˆ**: ä½¿ç”¨RuleGoè§„åˆ™å¼•æ“è¿›è¡Œäº¤æ˜“å†³ç­–
- **Feasté›†æˆ**: ä»Feastç‰¹å¾å­˜å‚¨è·å–å†å²ç‰¹å¾æ•°æ®
- **ç¦»çº¿å›æµ‹**: æ”¯æŒå®Œæ•´çš„ç¦»çº¿å†å²æ•°æ®å›æµ‹
- **é£é™©ç®¡ç†**: å†…ç½®æ­¢æŸã€æ­¢ç›ˆã€ä»“ä½æ§åˆ¶ç­‰é£é™©ç®¡ç†åŠŸèƒ½
- **è¯¦ç»†ç»Ÿè®¡**: æä¾›å®Œæ•´çš„å›æµ‹ç»Ÿè®¡åˆ†æ

### ğŸ“Š æ”¯æŒçš„ç‰¹å¾
- æŠ€æœ¯æŒ‡æ ‡ï¼šMAã€RSIã€å¸ƒæ—å¸¦ã€åŠ¨é‡æŒ‡æ ‡ç­‰
- ä»·æ ¼ç‰¹å¾ï¼šå¼€é«˜ä½æ”¶ã€æˆäº¤é‡ç­‰
- Alpha101å› å­ï¼šæ”¯æŒWorldQuant Alpha101å› å­åº“
- è‡ªå®šä¹‰ç‰¹å¾ï¼šæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰ç‰¹å¾

### ğŸ›¡ï¸ é£é™©æ§åˆ¶
- æ­¢æŸæ­¢ç›ˆï¼šå¯é…ç½®çš„æ­¢æŸæ­¢ç›ˆæ¯”ä¾‹
- ä»“ä½æ§åˆ¶ï¼šæœ€å¤§æŒä»“æ¯”ä¾‹é™åˆ¶
- ä¿¡å·è¿‡æ»¤ï¼šåŸºäºç½®ä¿¡åº¦çš„ä¿¡å·è¿‡æ»¤
- æ»‘ç‚¹æ¨¡æ‹Ÿï¼šçœŸå®çš„äº¤æ˜“æˆæœ¬æ¨¡æ‹Ÿ

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Feast Store   â”‚    â”‚   RuleGo Engine â”‚    â”‚  Backtest Engineâ”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Historical  â”‚ â”‚    â”‚ â”‚ Trading     â”‚ â”‚    â”‚ â”‚ Portfolio   â”‚ â”‚
â”‚ â”‚ Features    â”‚ â”‚â”€â”€â”€â”€â–¶â”‚ â”‚ Rules       â”‚ â”‚â”€â”€â”€â”€â–¶â”‚ â”‚ Management  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Alpha101    â”‚ â”‚    â”‚ â”‚ Signal      â”‚ â”‚    â”‚ â”‚ Risk        â”‚ â”‚
â”‚ â”‚ Factors     â”‚ â”‚    â”‚ â”‚ Generation  â”‚ â”‚    â”‚ â”‚ Management  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿å·²å®‰è£…æ‰€éœ€ä¾èµ–ï¼š

```bash
# å®‰è£…Pythonä¾èµ–
pip install feast pandas numpy requests

# å¯åŠ¨RuleGoæœåŠ¡ï¼ˆå¯é€‰ï¼Œå¯ä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼ï¼‰
cd decision_engine
go run main.go
```

### 2. é…ç½®Feast

ç¡®ä¿Feastç‰¹å¾ä»“åº“å·²æ­£ç¡®é…ç½®ï¼š

```bash
cd feast_config/feature_repo
feast apply
```

### 3. è¿è¡Œå›æµ‹

#### ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·

```bash
# åŸºæœ¬å›æµ‹
python backtest/run_backtest.py \
  --trading-pairs BTCUSDT ETHUSDT \
  --start-date 2024-01-01 \
  --end-date 2024-01-31 \
  --initial-capital 100000

# ä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼ï¼ˆä¸éœ€è¦RuleGoæœåŠ¡ï¼‰
python backtest/run_backtest.py \
  --trading-pairs BTCUSDT \
  --start-date 2024-01-01 \
  --end-date 2024-01-07 \
  --use-mock \
  --output results.json
```

#### ä½¿ç”¨Python API

```python
from datetime import datetime
from backtest.enhanced_backtest_engine import EnhancedBacktestEngine, EnhancedBacktestConfig

# åˆ›å»ºé…ç½®
config = EnhancedBacktestConfig(
    initial_capital=100000,
    use_mock_rulego=True,  # ä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼
    min_confidence=0.3
)

# åˆ›å»ºå¼•æ“
engine = EnhancedBacktestEngine(config)

# è¿è¡Œå›æµ‹
result, stats = engine.run_enhanced_backtest(
    trading_pairs=["BTCUSDT", "ETHUSDT"],
    start_date=datetime(2024, 1, 1),
    end_date=datetime(2024, 1, 31)
)

# æŸ¥çœ‹ç»“æœ
print(f"æ€»æ”¶ç›Šç‡: {result.total_return:.2%}")
print(f"å¤æ™®æ¯”ç‡: {result.sharpe_ratio:.2f}")
```

### 4. æŸ¥çœ‹ç»“æœ

å›æµ‹ç»“æœåŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š

- **åŸºç¡€æŒ‡æ ‡**: æ”¶ç›Šç‡ã€å¤æ™®æ¯”ç‡ã€æœ€å¤§å›æ’¤ç­‰
- **äº¤æ˜“ç»Ÿè®¡**: äº¤æ˜“æ¬¡æ•°ã€èƒœç‡ã€å¹³å‡æ”¶ç›Šç­‰  
- **ä¿¡å·åˆ†æ**: ä¿¡å·åˆ†å¸ƒã€ç½®ä¿¡åº¦ç»Ÿè®¡ç­‰
- **é£é™©æŒ‡æ ‡**: æ³¢åŠ¨ç‡ã€VaRã€æœ€å¤§è¿ç»­äºæŸç­‰

## é…ç½®è¯´æ˜

### å›æµ‹é…ç½® (EnhancedBacktestConfig)

```python
config = EnhancedBacktestConfig(
    # åŸºç¡€é…ç½®
    initial_capital=100000.0,      # åˆå§‹èµ„é‡‘
    commission_rate=0.001,         # æ‰‹ç»­è´¹ç‡
    slippage_rate=0.0005,         # æ»‘ç‚¹ç‡
    position_size=0.1,            # å•æ¬¡äº¤æ˜“èµ„é‡‘æ¯”ä¾‹
    
    # é£æ§é…ç½®
    stop_loss_pct=0.05,           # æ­¢æŸæ¯”ä¾‹
    take_profit_pct=0.1,          # æ­¢ç›ˆæ¯”ä¾‹
    min_confidence=0.3,           # æœ€å°ä¿¡å·ç½®ä¿¡åº¦
    
    # ç³»ç»Ÿé…ç½®
    feast_repo_path="/path/to/feast/repo",
    rulego_endpoint="http://localhost:8080",
    use_mock_rulego=False         # æ˜¯å¦ä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼
)
```

### YAMLé…ç½®æ–‡ä»¶

ä¹Ÿå¯ä»¥ä½¿ç”¨YAMLé…ç½®æ–‡ä»¶ï¼š

```yaml
# config/backtest_config.yaml
backtest:
  initial_capital: 100000.0
  commission_rate: 0.001
  position_size: 0.1

risk_management:
  stop_loss_pct: 0.05
  take_profit_pct: 0.1

feast:
  repo_path: "/workspace/feast_config/feature_repo"
  
rulego:
  endpoint: "http://localhost:8080"
  use_mock: false
```

## æµ‹è¯•

è¿è¡Œæµ‹è¯•å¥—ä»¶ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python tests/test_enhanced_backtest.py

# è¿è¡Œç‰¹å®šæµ‹è¯•
python -m unittest tests.test_enhanced_backtest.TestEnhancedBacktest.test_full_backtest_workflow
```

## æ¨¡æ‹Ÿæ¨¡å¼

å¦‚æœRuleGoæœåŠ¡ä¸å¯ç”¨ï¼Œå¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼ï¼š

```python
config = EnhancedBacktestConfig(use_mock_rulego=True)
```

æ¨¡æ‹Ÿæ¨¡å¼ä½¿ç”¨ç®€å•çš„RSIç­–ç•¥ï¼š
- RSI < 30: ä¹°å…¥ä¿¡å·
- RSI > 70: å–å‡ºä¿¡å·
- å…¶ä»–: æŒæœ‰ä¿¡å·

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Feastè¿æ¥å¤±è´¥**
   - æ£€æŸ¥ç‰¹å¾ä»“åº“è·¯å¾„æ˜¯å¦æ­£ç¡®
   - ç¡®ä¿å·²è¿è¡Œ `feast apply`
   - æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æƒé™

2. **RuleGoè¿æ¥å¤±è´¥**
   - ç¡®ä¿RuleGoæœåŠ¡æ­£åœ¨è¿è¡Œ
   - æ£€æŸ¥ç«¯ç‚¹URLæ˜¯å¦æ­£ç¡®
   - å¯ä»¥ä½¿ç”¨ `--use-mock` å‚æ•°å¯ç”¨æ¨¡æ‹Ÿæ¨¡å¼

3. **ç‰¹å¾æ•°æ®ä¸ºç©º**
   - æ£€æŸ¥æ—¶é—´èŒƒå›´æ˜¯å¦æœ‰æ•°æ®
   - ç¡®è®¤äº¤æ˜“å¯¹åç§°æ­£ç¡®
   - æ£€æŸ¥Feastç‰¹å¾å®šä¹‰

4. **å†…å­˜ä¸è¶³**
   - å‡å°‘æ—¶é—´èŒƒå›´æˆ–äº¤æ˜“å¯¹æ•°é‡
   - è°ƒæ•´æ‰¹å¤„ç†å¤§å°
   - ä½¿ç”¨æ›´å¤§çš„æœºå™¨

### æ—¥å¿—è°ƒè¯•

å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š

```bash
python backtest/run_backtest.py --log-level DEBUG
```

æˆ–åœ¨Pythonä»£ç ä¸­ï¼š

```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„ç‰¹å¾

1. åœ¨Feastä¸­å®šä¹‰æ–°ç‰¹å¾ï¼š

```python
# feast_config/feature_repo/features.py
new_feature_fv = FeatureView(
    name="new_features",
    entities=[trading_pair],
    schema=[
        Field(name="custom_indicator", dtype=Float64),
    ],
    source=offline_features_source,
)
```

2. åœ¨RuleGoé€‚é…å™¨ä¸­ä½¿ç”¨ï¼š

```python
# backtest/rulego_backtest_adapter.py
def convert_to_rulego_message(self, row):
    message = RuleGoMessage(
        # ... existing fields ...
        custom_indicator=float(row.get('new_features__custom_indicator', 0.0))
    )
```

### è‡ªå®šä¹‰ç­–ç•¥

å¯ä»¥é€šè¿‡ä¿®æ”¹RuleGoè§„åˆ™æˆ–å®ç°æ–°çš„é€‚é…å™¨æ¥æ·»åŠ è‡ªå®šä¹‰ç­–ç•¥ã€‚

## æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨æ‰¹å¤„ç†å‡å°‘APIè°ƒç”¨
- ç¼“å­˜ç‰¹å¾æ•°æ®é¿å…é‡å¤æŸ¥è¯¢
- å¹¶è¡Œå¤„ç†å¤šä¸ªäº¤æ˜“å¯¹
- ä½¿ç”¨æ›´å¿«çš„ç‰¹å¾å­˜å‚¨åç«¯

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚